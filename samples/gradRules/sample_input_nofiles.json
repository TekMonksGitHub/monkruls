{
    "functions": [{"name":"customGradFunctions", "code":"/**\n * Sample custom functions module\n * (C)  2020 TekMonks. All rights reserved.\n */\n\nexports.caseInsensitiveIsNotEqual = function(str1,str2) {\n    return str1.toLowerCase() != str2.toLowerCase();\n}"}],

    "objects": [
        {"name":"object", "data":"csv://courses_taken,gpa\nGER1111,1.9\nGET1111,\nGEH2222,\nGES1111,\nGET2222,\nCS1010,\nCS1231,\nCS1231S,\nCS2030,\nCS2040,\nCS2040S,\nCS2100,\nCS2103T,\nCS1101S,\nCS3219,\nCS3216,\nCS3217,\nCS2102,\nCS3223,\nCS4221,\nCS4224,\nCS4225,\nCS2107,\nCP4101,\nIS1103,\nCS2101,\nES2660,\nMA1301,\nMA1521,\nMA1101R,\nST2334,\nCM1502,\nUE1101,\nUE1102,\nUE1103,\nUE1104,\nUE1105,\nUE1106,\nUE1107,"}, 
        {"name":"GPA", "data":"valueOf(object.gpa[0])"}
    ],
    
    "data": [
        {"name":"course_categories", "data":{"ger":["GER1111","GER2222"],"get":["GET1111","GET2222"],"geh":["GEH1111","GEH2222"],"ges":["GES1111","GES2222"],"geq":["GEQ1111","GEQ2222"],"csf":["CS1010","CS1231","CS1231S","CS2030","CS2040","CS2040S","CS2100","CS2103T","CS2105","CS2106","CS3230","CS1101S","CS2101","CS1010E","CS1010R"],"csfnw":["CS2105","CS3103","CS4222","CS4226","CS4231","CS4274","CS4231"],"csfdb":["CS2102","CS3223","CS4221","CS4224","CS4225"],"csfsec":["CS2107","CS3235","CS4236","CS4238","CS4239","CS4276"],"itp":["IS1103","CS2101","ES2660"],"ms":["MA1301","MA1301FC","MA1301X","MA1521","MA1101R","ST2334"],"science":["CM1121","LSM1102","CM1502","MA1104"],"ue":["UE1101","UE1102","UE1103","UE1104","UE1105","UE1106","UE1107","UE1108","UE1109","UE1110","UE1111","UE1112","UE1113","UE1114","UE1115"]}},
        {"name":"course_mcs", "data":"csvlookuptable://course,mc\nCS1010,4\nCS1231,4\nCS1231S,4\nCS2030,4\nCS2040,4\nCS2040S,4\nCS2100,4\nCS2103T,4\nCS2105,4\nCS2106,4\nCS3230,4\nCS1101S,5\nCS2101,4\nCS1010E,4\nCS1010R,4\nGER1111,4\nGER2222,4\nGET1111,4\nGET2222,4\nGEH1111,4\nGEH2222,4\nGES1111,4\nGES2222,4\nGEQ1111,4\nGEQ2222,4\nCS2105,4\nCS3103,4\nCS4222,4\nCS4226,4\nCS4231,4\nCS4274,4\nCS4231,4\nCS2102,4\nCS3223,4\nCS4221,4\nCS4224,4\nCS4225,4\nCS2107,4\nCS3235,4\nCS4236,4\nCS4238,4\nCS4239,4\nCS4276,4\nCP4101,12\nCS3219,4\nCS3216,4\nCS3217,4\nCS3281,4\nCS3282,4\nTR3202,12\nCSIEXP,12\nIS1103,4\nCS2101,4\nES2660,4\nMA1301,4\nMA1301FC,4\nMA1301X,4\nMA1521,4\nMA1101R,4\nST2334,4\nCM1121,4\nLSM1102,4\nCM1502,4\nMA1104,4\nUE1101,4\nUE1102,4\nUE1103,4\nUE1104,4\nUE1105,4\nUE1106,4\nUE1107,4\nUE1108,4\nUE1109,4\nUE1110,4\nUE1111,4\nUE1112,4\nUE1113,4\nUE1114,4\nUE1115,4\n"}
    ],

    "rule_bundles": [
        {"name":"nus.ge5", "rules":[{"condition":"intersect_size(object.courses_taken, course_categories.ger)","do":"object.counts_ger = 1","else_do":"object.counts_ger = 0"},{"condition":"intersect_size(object.courses_taken, course_categories.get)","do":["object.counts_get = 1"],"else_do":"object.counts_get = 0","reason":"General Education requirements Thinking and Expression pillar not met"},{"condition":"intersect_size(object.courses_taken, course_categories.geh)","do":"object.counts_geh = 1","else_do":"object.counts_geh = 0","reason":"General Education requirements Human cultures pillar not met"},{"condition":"intersect_size(object.courses_taken, course_categories.ges)","do":"object.counts_ges = 1","else_do":"object.counts_ges = 0","reason":"General Education requirements Singapore studies pillar not met"},{"condition":"intersect_size(object.courses_taken, course_categories.geq)","do":"object.counts_geq = 1","else_do":"object.counts_geq = 0","reason":"General Education requirements Quantitiave pillar not met"},{"condition":"object.counts_ger+object.counts_get+object.counts_geh+object.counts_ges+object.counts_geq >= 4","do":"object.meets_ge5_1 = 1","reason":"Must meet General Education requirements, four of the five pillars"},{"condition":"object_sum(course_mcs,intersect(object.courses_taken, union(course_categories.ger, course_categories.get, course_categories.geh, course_categories.ges, course_categories.geq))) >= 20","do":"object.meets_ge5_2 = 1","reason":"General Education requirements total is below 20 MCs"},{"condition":"object.meets_ge5_1 && object.meets_ge5_2","do":"object.meets_ge5 = 1","reason":"General Education requirements not met, see - https://www.nus.edu.sg/registrar/academic-information-policies/undergraduate-students/general-education/five-pillars"}]}, 
        {"name":"nus.csf.", "rules":[{"condition":"object_sum(course_mcs,intersect(object.courses_taken, course_categories.csf)) >= 36","do":"object.meets_csf = 1","else_do":"object.meets_csf = 0","reason":"Core computer science foundation courses requirements not met"},{"condition":"object.courses_taken.includes('CS1101S')","do":"object.carry_over_for_uem = 1","reason":"Carrying over 1 MC for meeting Unrestricted module requirements"}]},
        {"name":"nus.csbd", "rules":[{"condition":"object.courses_taken.includes('CS3219')","do":"object.meets_csbd_1 = 1","reason":"CS3219 is required for breadth and depth requirements"},{"condition":"(object.courses_taken.includes('CS3216') && object.courses_taken.includes('CS3217')) || (object.courses_taken.includes('CS3281') && object.courses_taken.includes('CS3282'))","do":"object.meets_csbd_2 = 1","reason":"8 MCs of Computer systems team project is required"},{"condition":"count(match_pattern(intersect(object.courses_taken, course_categories.csfnw), '{{{CS4000_COURSE_PATTERN}}}')) >= 3","do":"object.meets_csfnw = 1","reason":"Meeting focus criteria with 3 modules at level 4000 or above is required, not found in Networks"},{"condition":"count(match_pattern(intersect(object.courses_taken, course_categories.csfdb), '{{{CS4000_COURSE_PATTERN}}}')) >= 3","do":"object.meets_csfdb = 1","reason":"Meeting focus criteria with 3 modules at level 4000 or above is required, not found in Databases"},{"condition":"count(match_pattern(intersect(object.courses_taken, course_categories.csfsec), '{{{CS4000_COURSE_PATTERN}}}')) >= 3","do":"object.meets_csfsec = 1","reason":"Meeting focus criteria with 3 modules at level 4000 or above is required, not found in Security"},{"condition":"object.meets_csfnw || object.meets_csfdb || object.meets_csfsec","do":"object.meets_csffa_1 = 1","reason":"Meeting focus criteria with 3 modules at level 4000 or above is required"},{"condition":"object_sum(course_mcs, intersect(object.courses_taken, union(course_categories.csfnw, course_categories.csfdb, course_categories.csfsec))) >= 24","do":"object.meets_csffa_2 = 1","reason":"Need at least 24 MCs from the focus area courses"},{"condition":"object.meets_csffa_1 && object.meets_csffa_2","do":"object.meets_csbd_3 = 1","reason":"Not able to meet the focus criteria"},{"condition":"object.courses_taken.includes('CP4101') || object.courses_taken.includes('TR3202') || object.courses_taken.includes('CSIEXP')","do":"object.meets_csbd_4 = 1","reason":"Not able to meet the industrial experience requirement"},{"condition":"object.meets_csbd_1 && object.meets_csbd_2 && object.meets_csbd_3 && object.meets_csbd_4","do":"object.meets_csbd = 1","else_do":"object.meets_csbd = 0","reason":"Not able to meet the CS breath and depth requirements"}]},
        {"name":"nus.itp_ms", "rules":[{"condition":"intersect_size(object.courses_taken, course_categories.itp) == 3","do":"object.meets_itp = 1","reason":"IT professionalism requirements not met"},{"condition":"intersect_size(object.courses_taken, course_categories.ms) >= 4","do":"object.meets_ms_1 = 1","reason":"Mathematics and sciences requirements not met, missing one of the four core courses"},{"condition":"intersect_size(object.courses_taken, course_categories.science) >= 1","do":"object.meets_ms_2 = 1","reason":"Science module under mathematics and sciences requirements not met"},{"condition":"object.meets_ms_1 && object.meets_ms_2","do":"object.meets_ms = 1","reason":"Mathematics and sciences requirements not met"}]},
        {"name":"nus.ue", "rules":[{"condition":"sum([object_sum(course_mcs,intersect(object.courses_taken, course_categories.ue)), object.carry_over_for_uem]) >= 28","do":"object.meets_ue = 1","reason":"Unrestricted modules, MCs are less than 28"}]},
        {"name":"nus.degree_classification", "rules":[{"decisiontable":"csv://GPA,Degree\n>=4.50,Honours (Highest Distinction)\n$>=4.00 && $<=4.49,Honours (Distinction)\n$>=3.50 && $<=3.99,Honours (Merit)\n$>=3 && $<=3.49,Honours\n$>=2.00 && $<=2.99,Pass\n<=1.99,Fail"}]},
        {"name":"nus.grad", "rules":[{"condition":"caseInsensitiveIsNotEqual(Degree,'fail')","do":["object.meets_gpa = 1","object.degree=Degree"],"else_do":["object.meets_gpa = 0","object.degree=Degree"],"reason":"Degree shows failed, most probably GPA issue."},{"condition":"object.meets_ms && object.meets_csbd && object.meets_csf && object.meets_ge5 && object.meets_itp && object.meets_gpa","do":"object.meets_grad = 1","else_do":"object.meets_grad = 0","reason":"One of the graduation conditions above was not met."}]}
    ],
    
    "outputs": [
        {"name":"object", "output":"object"},
        {"name":"$failed_reasons", "output":"$failed_reasons"},
        {"name":"$failed_rules", "output":"$failed_rules"}
    ],

    "rule_parameters": [
        {"name": "CS4000_COURSE_PATTERN", "value":"CS4..."}
    ]
}
